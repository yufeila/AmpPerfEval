# AD9851 休眠模式问题解决方案

## 问题描述
AD9851在串行写入模式下，当控制字的D7位（Power-Down位）被设置为1时，芯片会进入休眠模式，导致无法输出正常波形。

## 问题原因分析
1. **控制字构造不完整**：原代码只设置了bit0（6倍频位），但没有明确设置Power-Down位（D7位）为0
2. **每次调用都重新初始化**：`AD9851_Set_Frequency`函数每次都会调用`AD9851_Init`，可能导致控制字被重置
3. **缺少控制字位定义**：没有明确定义AD9851控制字的各个位

## 解决方案

### 1. 添加控制字位定义
在`bsp_ad9851.h`中添加了完整的控制字位定义：
```c
#define AD9851_POWER_DOWN_D7    0x80    // 休眠模式位 (bit7, D7位)
#define AD9851_CTRL_NORMAL      0x00    // 正常工作模式
#define AD9851_CTRL_POWER_DOWN  0x84    // 休眠模式 (bit7=1, bit2=1)
```

### 2. 修改控制字构造逻辑
在`AD9851_Setfq`函数中：
- 使用`AD9851_CTRL_NORMAL`作为默认值
- 明确清除D7位：`control_word &= ~AD9851_POWER_DOWN_D7`
- 添加控制字检查功能

### 3. 优化频率设置函数
修改`AD9851_Set_Frequency`函数：
- 移除每次调用时的重新初始化
- 避免不必要的重复初始化

### 4. 添加休眠模式退出函数
新增`AD9851_Exit_Power_Down`函数：
- 发送正常的控制字确保D7位为0
- 在模式切换时调用，确保AD9851正常工作

### 5. 添加调试功能
- 新增`AD9851_Check_Control_Word`函数检查控制字
- 启用调试输出，便于问题排查

## 修改的文件
1. `AmpPerfEval/Users/ad9851/bsp_ad9851.h` - 添加位定义和函数声明
2. `AmpPerfEval/Users/ad9851/bsp_ad9851.c` - 修改核心函数逻辑
3. `AmpPerfEval/Users/data_process/sweep_freq_response.c` - 在模式切换时调用退出休眠函数

## 使用方法
1. 在基本测量模式开始时，会自动调用`AD9851_Exit_Power_Down()`确保AD9851正常工作
2. 在扫频测量模式开始时，也会自动调用退出休眠函数
3. 每次设置频率时，都会检查控制字确保D7位为0

## 验证方法
1. 通过串口调试输出查看控制字是否正确设置
2. 观察AD9851输出波形是否正常
3. 检查是否还会出现无输出的情况

## 注意事项
- 确保在模式切换时调用`AD9851_Exit_Power_Down()`
- 如果仍有问题，可以手动调用退出休眠函数
- 调试输出可以通过`AD9851_DEBUG_ENABLE`宏控制 